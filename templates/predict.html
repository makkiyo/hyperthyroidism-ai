<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Hyperthyroidism Risk Prediction</title>

  <!-- Industry font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#2d136f;
      --bg2:#5a2bbf;
      --bg3:#7b5cff;

      --text:#ffffff;
      --muted: rgba(255,255,255,0.78);

      --glass: rgba(255,255,255,0.10);
      --glassBorder: rgba(255,255,255,0.16);

      --inputBg: rgba(255,255,255,0.10);
      --inputBorder: rgba(255,255,255,0.22);

      --primary:#2c7be5;
      --primary2:#00b4ff;

      --radius:20px;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: Inter, Arial, sans-serif;
      color:var(--text);
      min-height:100vh;

      background:
        radial-gradient(circle at 20% 25%, rgba(123,92,255,0.35), transparent 40%),
        radial-gradient(circle at 80% 75%, rgba(90,43,191,0.35), transparent 42%),
        linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
      background-attachment: fixed;
    }

    /* Top nav */
    .nav{
      padding:16px 28px;
      display:flex;
      align-items:center;
      justify-content:space-between;

      background: rgba(255,255,255,0.06);
      border-bottom: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }

    .brand{
      font-weight:900;
      letter-spacing:0.2px;
      font-size:14px;
      opacity:0.95;
    }

    .nav a{
      color:var(--text);
      text-decoration:none;
      font-weight:800;
      opacity:0.9;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      transition: transform .12s ease, opacity .12s ease, border-color .12s ease;
    }
    .nav a:hover{
      opacity:1;
      transform: translateY(-1px);
      border-color: rgba(255,255,255,0.22);
    }

    /* Page container */
    .page{
      width:min(1100px, 100%);
      margin:0 auto;
      padding:26px 18px 40px;
    }

    /* Header */
    .pagehead{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-bottom:16px;
    }

    .pagehead h1{
      margin:0;
      font-size:28px;
      letter-spacing:-0.6px;
      line-height:1.15;
    }

    .pagehead p{
      margin:0;
      color:var(--muted);
      line-height:1.6;
      font-size:14px;
      max-width:820px;
    }

    /* Main 2-column layout */
    .grid{
      display:grid;
      grid-template-columns: 1fr 1.15fr;
      gap:18px;
      align-items:stretch;
    }

    /* Glass card */
    .card{
      background: var(--glass);
      border: 1px solid var(--glassBorder);
      border-radius: var(--radius);
      padding:20px;
      box-shadow: 0 24px 60px rgba(0,0,0,0.35);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      display:flex;
      flex-direction:column;

      transition: transform .18s ease, border-color .18s ease, box-shadow .18s ease;
      min-height: 460px;
    }

    .card:hover{
      transform: translateY(-2px);
      border-color: rgba(255,255,255,0.24);
      box-shadow: 0 28px 70px rgba(0,0,0,0.42);
    }

    .card h2{
      margin:0 0 8px;
      font-size:18px;
      font-weight:900;
      letter-spacing:-0.3px;
    }

    .card .desc{
      margin:0 0 16px;
      color:var(--muted);
      font-size:13px;
      line-height:1.6;
    }

    /* Input form */
    form{
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    label{
      font-weight:800;
      font-size:13px;
      color: rgba(255,255,255,0.90);
    }

    .input-row{ position:relative; }

    input{
      width:100%;
      padding:13px 54px 13px 14px;
      border-radius:14px;
      border:1px solid var(--inputBorder);
      background: var(--inputBg);
      color: var(--text);
      outline:none;
      font-size:14px;

      transition: border-color .12s ease, box-shadow .12s ease, transform .12s ease;
    }

    input::placeholder{ color: rgba(255,255,255,0.45); }

    input:focus{
      border-color: rgba(255,255,255,0.55);
      box-shadow: 0 0 0 4px rgba(44,123,229,0.22);
      transform: translateY(-1px);
    }

    .unit{
      position:absolute;
      right:10px;
      top:50%;
      transform:translateY(-50%);
      font-size:12px;
      font-weight:800;
      color: rgba(255,255,255,0.72);
      pointer-events:none;

      padding:4px 8px;
      border-radius:999px;
      background: rgba(0,0,0,0.10);
      border: 1px solid rgba(255,255,255,0.10);
    }

    .helper{
      margin:0;
      font-size:12px;
      color: rgba(255,255,255,0.65);
      line-height:1.4;
    }

    button{
      margin-top:6px;
      padding:13px;
      border:none;
      border-radius:14px;
      background: linear-gradient(90deg, var(--primary), var(--primary2));
      color:#fff;
      font-weight:900;
      cursor:pointer;

      transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
      box-shadow: 0 12px 26px rgba(0,0,0,0.25);
    }

    button:hover{ filter:brightness(0.97); }
    button:active{ transform: translateY(1px); }

    /* Result content */
    .result-wrap{
      display:flex;
      flex-direction:column;
      gap:12px;
      flex:1;
    }

    .result-summary{
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.08);
      padding:16px;
      text-align:left;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 12px;
      border-radius:999px;
      font-size:12px;
      font-weight:900;
      border:1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.07);
      color: rgba(255,255,255,0.92);
    }

    .status{
      margin-top:12px;
      font-size:22px;
      font-weight:900;
      letter-spacing:-0.3px;
    }

    .status.high{ color:#ffb1b1; }
    .status.normal{ color:#9dffbf; }

    .meta{
      margin-top:8px;
      color: var(--muted);
      font-weight:800;
      font-size:13px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    .meta span{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.10);
    }

    .chart-box{
      margin-top:auto;
      height:250px;
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
    }

    #confidenceChart{
      width:100% !important;
      height:100% !important;
      display:block;
    }

    /* Interpretation footer card */
    .footer-card{
      margin-top:18px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: var(--radius);
      padding:16px 18px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .footer-card h3{
      margin:0 0 8px;
      font-size:14px;
      font-weight:900;
      letter-spacing:-0.2px;
    }

    .footer-card p{
      margin:0;
      color: rgba(255,255,255,0.74);
      line-height:1.6;
      font-size:12.5px;
    }

    /* Responsive */
    @media(max-width: 980px){
      .grid{ grid-template-columns:1fr; }
      .card{ min-height: unset; }
      .chart-box{ height:220px; }
    }
  </style>
</head>

<body>

  <div class="nav">
    <div class="brand">Hyperthyroidism DSS</div>
    <a href="/">Home</a>
  </div>

  <main class="page">

    <!-- Page header -->
    <header class="pagehead">
      <h1>Hyperthyroidism Risk Prediction</h1>
      <p>
        Enter laboratory values below to generate a model-based risk estimate. This tool provides decision support only
        and should be interpreted alongside clinical findings.
      </p>
    </header>

    <section class="grid">

      <!-- Input card -->
      <div class="card">
        <h2>Input</h2>
        <p class="desc">Provide TSH, T3, and TT4 values exactly as reported by the laboratory.</p>

        <form method="POST">
          <div class="field">
            <label>TSH Level</label>
            <div class="input-row">
              <input type="number" step="any" name="tsh" placeholder="e.g., 0.40" required>
              <span class="unit">mIU/L</span>
            </div>
            <p class="helper">Reference ranges vary by laboratory.</p>
          </div>

          <div class="field">
            <label>T3 Level</label>
            <div class="input-row">
              <input type="number" step="any" name="t3" placeholder="e.g., 1.20" required>
              <span class="unit">ng/mL</span>
            </div>
            <p class="helper">Reference ranges vary by laboratory.</p>
          </div>

          <div class="field">
            <label>TT4 Level</label>
            <div class="input-row">
              <input type="number" step="any" name="tt4" placeholder="e.g., 8.00" required>
              <span class="unit">µg/dL</span>
            </div>
            <p class="helper">Reference ranges vary by laboratory.</p>
          </div>

          <button type="submit">Predict Risk</button>
        </form>

        <p class="helper" style="margin-top:12px;">
          This system does not provide a medical diagnosis.
        </p>
      </div>

      <!-- Result card -->
      <div class="card">
        <h2>Result</h2>
        <p class="desc">The model returns the predicted class and confidence score.</p>

        <div class="result-wrap">

          {% if prediction %}
            <div class="result-summary">
              <div class="pill">Model Output</div>

              <div class="status {{ 'high' if 'High' in prediction else 'normal' }}">
                {{ prediction }}
              </div>

              <div class="meta">
                <span>Confidence: {{ "%.2f"|format(confidence) }}%</span>
                <span>Output: Classification</span>
              </div>
            </div>

          {% elif error %}
            <div class="result-summary">
              <div class="pill">Error</div>
              <div class="status high" style="font-size:16px;">{{ error }}</div>
              <div class="meta">
                <span>Please verify the inputs.</span>
              </div>
            </div>

          {% else %}
            <div class="result-summary">
              <div class="pill">Waiting</div>
              <div style="margin-top:12px;color:var(--muted);font-weight:800;">
                Submit values in the Input panel to display results and the chart.
              </div>
            </div>
          {% endif %}

          <div class="chart-box">
            <canvas id="confidenceChart"></canvas>
          </div>

          <p class="helper">
            Confidence is shown as a percentage. Higher confidence indicates stronger model certainty for the predicted class.
          </p>
        </div>
      </div>

    </section>

    <!-- Interpretation + disclaimer -->
    <section class="footer-card">
      <h3>Interpretation & Disclaimer</h3>
      <p>
        A “High Risk” prediction indicates that the entered laboratory pattern is similar to cases labeled as high-risk in the model’s training dataset.
        Results should be interpreted with patient history, physical examination, and additional tests as needed.
        This tool is for academic demonstration and decision support only, and does not replace professional medical judgment.
      </p>
    </section>

  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    const predictionExists = {{ (prediction is not none) | tojson }};
    const confidence = {{ (confidence or 0) | tojson }};
    const predictionText = {{ (prediction or "") | tojson }};

    // Auto-color chart: Normal = green, High = red
    const isHigh = (predictionText || "").toLowerCase().includes("high");
    const mainColor = isHigh ? "rgba(255, 99, 132, 0.95)" : "rgba(46, 213, 115, 0.95)";
    const remainingColor = "rgba(255,255,255,0.16)";

    if (predictionExists) {
      const canvas = document.getElementById("confidenceChart");
      if (canvas) {
        const ctx = canvas.getContext("2d");

        new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: ["Confidence", "Remaining"],
            datasets: [{
              data: [confidence, 100 - confidence],
              backgroundColor: [mainColor, remainingColor],
              borderWidth: 0,
              hoverOffset: 6
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                labels: {
                  color: "rgba(255,255,255,0.85)",
                  boxWidth: 12
                }
              },
              tooltip: { enabled: true }
            },
            cutout: "70%"
          }
        });
      }
    }
  </script>

</body>
</html>
